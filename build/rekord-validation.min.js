!function(e,t,r){function n(e){var t=parseFloat(e);return isNaN(t)||(e=t),e}function a(e){var t=parseInt(e);return isNaN(t)||(e=t),e}function i(e){return V(e)?e.setHours(0,0,0,0):z(e)&&(e-=e%864e5),e}function s(e){return V(e)?e.setHours(23,59,59,999):z(e)&&(e=e-e%864e5+864e5-1),e}function u(e,t,r){B.Rules[e]=function(t,n,a,i,s){c(e,t,n);var u=o(e,s);return function(e,n,a){function s(t){e=t}return r(e,n,s)&&a(m(t,i(t),e,n,u)),e}},B.Rules[e].message=t}function o(e,t){return t||B.Rules[e].message}function l(e,t,r,n){var a=e.slice();if(n)for(var i=0;i<a.length;i++)a[i]=n(a[i]);var s=a.pop(),t=t||"and",r=r||", ";switch(a.length){case 0:return s;case 1:return a[0]+" "+t+" "+s;default:return a.join(r)+r+t+" "+s}}function f(e,t){for(var r={},n=0;n<e.length;n++)r[e[n]]=t;return r}function c(e,t,r){if(r)throw"the rule "+e+" for field "+t+" has no arguments"}function m(e,t,r,n,a,i){j(a)&&(a=a(e,t,r,n,i));var s={};return s.$field=e,s.$alias=t,s.$value=r,L(n,s),M(i)&&L(i,s),I(a,s)}function d(e,t,r){B.Rules[e]=function(t,n,a,i,s){if(!n)throw e+" validation rule requires field & value arguments";var u,l,f;if(A(n)){var c=n.indexOf(",");if(-1===c)throw e+" validation rule requires field & value arguments";u=n.substring(0,c),l=n.substring(c+1)}else D(n)?(u=n[0],l=n[1],f=n[2]):M(n)&&(u=n.field,l=n.value,f=n.equals);if(j(f)||(f=S),-1===Z(a.fields,u))throw otherField+" is not a valid field for the "+e+" rule";var d=o(e,s),h={$matchField:u,$matchAlias:i(u),$matchValue:l};return function(e,n,a){return r(e,n,u,l,f)&&a(m(t,i(t),e,n,d,h)),e}},B.Rules[e].message=t}function h(e,t,r){B.Rules[e]=function(t,n,a,i,s){if(!n)throw e+" validation rule requires a date expression argument";var u;if(A(n))u=B.parseExpression(n,a);else if(j(n))u=n;else{var l=W(n);if(l!==!1){var f=l.getTime();u=function(){return f}}}if(!u||u===P)throw n+" is not a valid date expression for the "+e+" rule";var c=o(e,s),d={$date:n};return function(e,n,a){var s=W(e);if(s!==!1){e=s.getTime();var o=u(e,n);z(o)&&r(e,o)&&a(m(t,i(t),e,n,c,d))}return e}},B.Rules[e].message=t}function v(e,t,r){B.Rules[e]=function(t,n,a,i,s){if(!n)throw e+" validation rule requires a field and list arguments";var u,c;if(A(n)){var d=C(n,/(,)/,"\\");u=d.shift(),c=d}else D(n)?(u=n.shift(),c=n):M(n)&&(u=n.field,c=n.values);if(Z(a.fields,u)===!1)throw u+" is not a valid field for the "+e+" rule";var h=o(e,s),v=l(c),$={$params:n,$matchField:u,$matchAlias:i(u),$list:v},g=f(c,!0);return function(e,n,a){return r(e,n,u,c,g)&&a(m(t,i(t),e,n,h,$)),e}},B.Rules[e].message=t}function $(e,t,r){B.Rules[e]=function(t,n,a,i,s){if(!n)throw e+" validation rule requires an array of fields argument";for(var u=C(n,/(\s*,\s*)/,"\\"),f=0;f<u.length;f++)if(-1===Z(a.fields,u[f]))throw u[f]+" is not a valid field for the "+e+" rule";var c=o(e,s),d=l(u),h=l(u,!1,!1,i),v={$fields:d,$fieldAliases:h};return function(e,n,a){function s(t){e=t}return r(e,n,u,s)&&a(m(t,i(t),e,n,c,v)),e}},B.Rules[e].message=t}function g(e,r,n){B.Rules[e]=function(r,a,i,s,u){var l,f,c;if(!k(a)||A(a)){var d=C(a||"",/(\s*,\s*)/,"\\");l=d[0]||i.name,c=d[1]||r,f=null}else D(a)?(l=A(a[0])?a.shift():i.name,c=A(a[0])?a.shift():r,f=new ModelCollection(i,a)):M(a)&&(l=a.model||i.name,c=a.field||r,f=a.models);if(!f){if(!l)throw"model, model class, or models is required for "+e+" rule";A(l)?t.get(l).success(function(e){f=e.all()}):isRekord(l)&&(f=l.all())}if(Z(i.fields,c)===!1)throw c+" is not a valid field for the "+e+" rule";var h=o(e,u),v={$class:l,$matchField:c,$matchAlias:s(c)};return function(e,t,a){return f&&k(e)&&n(e,t,f,c)&&a(m(r,s(r),e,t,h,v)),e}},B.Rules[e].message=r}function b(e,t){B.Rules[e]=function(r,n,a,i,s){if(!n)throw e+" validation rule requires a validation rule argument";var u,o;if(A(n)){var l=n.indexOf(":");if(-1===l)throw n+" is not a valid argument for the "+e+" rule";u=n.substring(0,l)||r,o=n.substring(l+1)}else D(n)?(u=n.shift()||r,o=n):M(n)&&(u=n.field||r,o=n.rules);if(-1===Z(a.fields,u))throw u+" is not a valid field for the "+e+" rule";if(!o)throw"rules are required for the "+e+" rule";var f=B.parseRules(o,u,a,i);return function(e,r,n){for(var a=0,i=function(e){e&&a++},s=0;s<f.length;s++)f[s](e,r,i);return t(a,f.length)?B.Stop:e}}}function p(e,t,r){B.Rules[e]=function(t,n,a,i,s){if(!n)throw e+" validation rule requires a list argument";var u,c=!1;if(A(n)?u=C(n,/(,)/,"\\"):D(n)?u=n:j(n)&&(u=c),c!==!1&&(!u||0===u.length))throw n+" is not a valid list of values for the "+e+" rule";if(G(u)){var d=f(u,!0);c=function(e){return d[e]}}else c=function(e){return Z(u,e,O)};var h=o(e,s),v=l(u,"or"),$={$params:n,$list:v};return function(e,n,a){return r(e,n,c)&&a(m(t,i(t),e,n,h,$)),e}},B.Rules[e].message=t}function R(e,t,r){B.Rules[e]=function(t,n,a,i,s){if(!n)throw e+" validation rule requires a range argument";var u,l;if(A(n)){var f=C(n,/(\s*,\s*)/,"\\");u=parseFloat(f[0]),l=parseFloat(f[1])}else D(n)?(u=n[0],l=n[1]):M(n)&&(u=n.start,l=n.end);if(isNaN(u)||isNaN(l))throw n+" is not a valid range of numbers for the "+e+" rule";A(s)&&(s={string:s,number:s,object:s});var c=o(e,s),d={$start:u,$end:l};return function(e,n,a){var s=Y(e),o=typeof e,f=c[o];return f&&r(s,u,l)&&(d.$size=s,a(m(t,i(t),e,n,f,d))),e}},B.Rules[e].message=t}function w(e,t,r){B.Rules[e]=function(t,n,a,i,s){c(e,t,n);var u=o(e,s);return function(e,n,a){return r.test(e)||a(m(t,i(t),e,n,u)),e}},B.Rules[e].message=t}function y(e,t,r){B.Rules[e]=function(t,n,a,i,s){var u;if(A(n)?u=parseFloat(n):z(n)&&(u=n),isNaN(u))throw'"'+n+'" is not a valid number for the '+e+" rule";A(s)&&(s={string:s,number:s,object:s});var l=o(e,s),f={$number:n};return function(e,n,a){var s=Y(e),o=typeof e,c=l[o];return c&&r(s,u)&&(f.$size=s,a(m(t,i(t),e,n,c,f))),e}},B.Rules[e].message=t}var x=t.Model,q=t.Database,E=t.Promise,F=t.Collection,_=t.isEmpty,A=t.isString,D=t.isArray,M=t.isObject,j=t.isFunction,V=t.isDate,z=t.isNumber,N=t.isBoolean,k=t.isValue,G=t.isPrimitiveArray,T=t.isRegExp,P=t.noop,S=t.equalsCompare,O=t.equals,Z=t.indexOf,Y=t.sizeof,C=t.split,L=t.transfer,I=t.format,W=t.parseDate,H=t.addMethod,U=t.replaceMethod;t.on(t.Events.Plugins,function(e,n,a){function i(e){return l[e]||e}var s=a.validation||q.Defaults.validation;if(!_(s)){var u=s.rules||{},o=s.messages||{},l=s.aliases||{},f=!!s.required;n.validations={};for(var c in u)n.validations[c]=B.parseRules(u[c],c,n,i,o[c]);H(e.prototype,"$validate",function(){var e=this;this.$trigger(x.Events.PreValidate,[this]),this.$valid=!0,this.$validations={},this.$validationMessages.length=0;for(var t in n.validations)for(var r=n.validations[t],a=this.$get(t),i=!0,s=function(r){r&&i&&(i=!1,e.$validations[t]=r,e.$validationMessages.push(r),e.$valid=!1)},u=0;u<r.length&&i&&a!==B.Stop;u++)a=r[u](a,this,s);return this.$trigger(this.$valid?x.Events.ValidatePass:x.Events.ValidateFail,[this]),this.$valid}),U(e.prototype,"$init",function(e){return function(){return this.$valid=r,this.$validations={},this.$validationMessages=[],e.apply(this,arguments)}}),f&&U(e.prototype,"$save",function(e){return function(){return this.$isDeleted()?(t.debug(t.Debugs.SAVE_DELETED,this.$db,this),E.resolve(this)):this.$validate()?e.apply(this,arguments):E.resolve(this)}})}}),x.Events.PreValidate="pre-validate",x.Events.ValidatePass="validate-pass",x.Events.ValidateFail="validate-fail";var B={Rules:{},Expression:{},Expressions:[],Delimiter:/([|])/,Escape:"\\",RuleSeparator:":",Stop:{},parseRules:function(e,t,n,a,i){var s=[];if(A(e)&&(e=C(e,this.Delimiter,this.Escape)),D(e))for(var u=0;u<e.length;u++){var o=e[u],l=this.parseRule(o,t,n,a,i);s.push(l)}else if(M(e))for(var o in e){var f=e[o],c=M(f)?f.message:A(f)?f:r,m=M(f)&&f.message?f.input:A(f)?r:f,l=this.parseRule(o,t,n,a,c||i,m);s.push(l)}return s},parseRule:function(e,t,r,n,a,i){var s=e.indexOf(this.RuleSeparator),u=-1===s?e:e.substring(0,s);if("$"===u.charAt(0))return this.customValidator(u,t,r,n,a);var o=-1===s?i:e.substring(s+1),l=B.Rules[u];if(!l)throw u+" is not a valid rule";return l(t,o,r,n,a)},parseExpression:function(e,t){for(var r=B.Expressions,n=0;n<r.length;n++){var a=r[n],i=a(e,t);if(j(i))return i}return P},customValidator:function(e,t,r,n,a){return function(t,r,i){var s=r[e](t,n,a);return A(s)&&i(s),t}}};B.Expression.date=B.Expressions.push(function(e,t){var r=W(e);if(r!==!1){var n=r.getTime();return function(e,t){return n}}})-1,B.Expression.field=B.Expressions.push(function(e,t){return Z(t.fields,e)?function(t,r){return r.$get(e)}:void 0})-1;var J=/^([+-]\d+(\.\d+)?)\s*(.+)$/,K={ms:1,millisecond:1,milliseconds:1,s:1e3,second:1e3,seconds:1e3,min:6e4,mins:6e4,minute:6e4,minutes:6e4,hr:36e5,hour:36e5,hours:36e5,day:864e5,days:864e5,wk:6048e5,week:6048e5,weeks:6048e5,month:["getMonth","setMonth"],months:["getMonth","setMonth"],yr:["getFullYear","setFullYear"],year:["getFullYear","setFullYear"],years:["getFullYear","setFullYear"]};B.Expression.relative=B.Expressions.push(function(e,t){var r=J.exec(e);if(null!==r){var n=parseFloat(r[1]),a=r[3],i=K[a];if(!i)throw a+" is not a valid unit.";return function(e,t){var r=new Date;if(z(i))r.setTime(r.getTime()+i*n);else{var a=i[0],s=i[1];r[s](r[a]()+n)}return r.getTime()}}})-1,B.Expression.today=B.Expressions.push(function(e,t){return"today"===e?function(e,t){var r=new Date;return i(r),r.getTime()}:void 0})-1,B.Expression.tomorrow=B.Expressions.push(function(e,t){return"tomorrow"===e?function(e,t){var r=new Date;return r.setDate(r.getDate()+1),i(r),r.getTime()}:void 0})-1,B.Expression.yesterday=B.Expressions.push(function(e,t){return"yesterday"===e?function(e,t){var r=new Date;return r.setDate(r.getDate()-1),i(r),r.getTime()}:void 0})-1,B.Rules.accepted=function(e,t,r,n,a){c("accepted",e,t);var i=o("accepted",a),s=B.Rules.accepted.acceptable;return function(t,r,a){var u=(t+"").toLowerCase(),o=s[u];return o||a(m(e,n(e),t,r,i)),t}},B.Rules.accepted.message="{$alias} has not been accepted.",B.Rules.accepted.acceptable={1:!0,yes:!0,on:!0,y:!0,"true":!0},d("contains","{$alias} does not contain an item whose {$matchAlias} equals {$matchValue}.",function(e,t,r,n,a){return!e.contains(function(e){return e!==t&&a(n,e.$get(r))})}),d("not_contains","{$alias} contains an item whose {$matchAlias} equals {$matchValue}.",function(e,t,r,n,a){return e.contains(function(e){return e!==t&&a(n,e.$get(r))})}),B.Rules.validate=function(e,t,r,n,a){var i=t||"message",s=o("validate",a);return function(t,r,a){if(D(t)){for(var u=new F,o=0;o<t.length;o++){var r=t[o];r&&r.$validate&&!r.$validate()&&u.push(r)}if(u.length)switch(i){case"models":a(u);break;case"validations":a(u.pluck("$validations","$$key"));break;default:a(m(e,n(e),t,r,s))}}return t}},B.Rules.validate.message="{$alias} is not valid.",h("after","{$alias} must be after {$date}.",function(e,t){return e<s(t)}),h("after_on","{$alias} must be after or equal to {$date}.",function(e,t){return t>e}),h("before","{$alias} must be before {$date}.",function(e,t){return e>t}),h("before_on","{$alias} must be before or equal to {$date}.",function(e,t){return e>s(t)}),u("date_like","{$alias} must be a valid date.",function(e,t,r){var n=W(e),a=n===!1;return a||r(n.getTime()),a}),v("required_if","{$alias} is required.",function(e,t,r,n,a){var i=a[t.$get(r)];return i&&_(e)}),v("required_unless","{$alias} is required.",function(e,t,r,n,a){var i=!a[t.$get(r)];return i&&_(e)}),$("confirmed","{$alias} must match {$fieldAliases}.",function(e,t,r,n){for(var a=!0,i=0;i<r.length;i++)O(e,t.$get(r[i]))||(a=!1);return!a}),$("different","{$alias} must not match {$fieldAliases}.",function(e,t,r,n){for(var a=!1,i=0;i<r.length;i++)O(e,t.$get(r[i]))||(a=!0);return!a}),$("if_valid","",function(e,t,r,n){for(var a=!0,i=0;i<r.length&&a;i++)t.$validations[r[i]]&&(a=!1);return a||n(B.Stop),!1}),$("required_with","{$alias} is required.",function(e,t,r,n){for(var a=!1,i=0;i<r.length&&!a;i++)_(t.$get(r[i]))||(a=!0);return a&&_(e)}),$("required_with_all","{$alias} is required.",function(e,t,r,n){for(var a=!0,i=0;i<r.length&&a;i++)_(t.$get(r[i]))&&(a=!1);return a&&_(e)}),$("required_without","{$alias} is required.",function(e,t,r,n){for(var a=!1,i=0;i<r.length&&!a;i++)_(t.$get(r[i]))&&(a=!0);return a&&_(e)}),$("required_without_all","{$alias} is required.",function(e,t,r,n){for(var a=!0,i=0;i<r.length&&a;i++)_(t.$get(r[i]))||(a=!1);return a&&_(e)}),g("exists","{$alias} must match an existing {$matchAlias} in a {$class}",function(e,t,r,n){return!r.contains(function(r){return r!==t&&O(e,r.$get(n))})}),g("unique","{$alias} must be a unique {$matchAlias} in a {$class}",function(e,t,r,n){return r.contains(function(r){return r!==t&&O(e,r.$get(n))})}),b("if",function(e,t){return e>0}),b("if_any",function(e,t){return e>=t}),b("if_not",function(e,t){return t>e}),p("in","{$alias} must be one of {$list}.",function(e,t,r){return!r(e,t)}),p("not_in","{$alias} must not be one of {$list}.",function(e,t,r){return r(e,t)}),R("between",{string:"{$alias} must have between {$start} to {$end} characters.",number:"{$alias} must be between {$start} and {$end}.",object:"{$alias} must have between {$start} to {$end} items."},function(e,t,r){return t>e||e>r}),R("not_between",{string:"{$alias} must not have between {$start} to {$end} characters.",number:"{$alias} must not be between {$start} and {$end}.",object:"{$alias} must not have between {$start} to {$end} items."},function(e,t,r){return e>=t&&r>=e}),w("alpha","{$alias} should only contain alphabetic characters.",/^[a-zA-Z]*$/),w("alpha_dash","{$alias} should only contain alpha-numeric characters, dashes, and underscores.",/^[a-zA-Z0-9_-]*$/),w("alpha_num","{$alias} should only contain alpha-numeric characters.",/^[a-zA-Z0-9]*$/),w("email","{$alias} is not a valid email.",/^.+@.+\..+$/),w("url","{$alias} is not a valid URL.",/^(https?:\/\/)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)$/),w("uri","{$alias} is not a valid URI.",/^(\w+:\/\/)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)$/),w("phone","{$alias} is not a valid phone number.",/^1?\W*([2-9][0-8][0-9])\W*([2-9][0-9]{2})\W*([0-9]{4})(\se?x?t?(\d*))?$/),B.Rules.regex=function(e,t,r,n,a){var i;if(A(t)){var s=/^\/(.*)\/([gmi]*)$/.exec(t);s&&(i=new RegExp(s[1],s[2]))}else T(t)&&(i=t);if(!i)throw t+" is not a valid regular expression for the regex rule";var u=o("regex",a);return function(t,r,a){return i.test(t)||a(m(e,n(e),t,r,u)),t}},B.Rules.regex.message="{$alias} is not a valid value.",u("required","{$alias} is required.",function(e){return _(e)}),y("min",{string:"{$alias} must have a minimum of {$number} characters.",number:"{$alias} must be at least {$number}.",object:"{$alias} must have at least {$number} items."},function(e,t){return t>e}),y("greater_than",{string:"{$alias} must have more than {$number} characters.",number:"{$alias} must be greater than {$number}.",object:"{$alias} must have more than {$number} items."},function(e,t){return t>=e}),y("max",{string:"{$alias} must have no more than {$number} characters.",number:"{$alias} must be no more than {$number}.",object:"{$alias} must have no more than {$number} items."},function(e,t){return e>t}),y("less_than",{string:"{$alias} must have less than {$number} characters.",number:"{$alias} must be less than {$number}.",object:"{$alias} must have less than {$number} items."},function(e,t){return e>=t}),y("equal",{string:"{$alias} must have {$number} characters.",number:"{$alias} must equal {$number}.",object:"{$alias} must have {$number} items."},function(e,t){return e!==t}),y("not_equal",{string:"{$alias} must not have {$number} characters.",number:"{$alias} must not equal {$number}.",object:"{$alias} must not have {$number} items."},function(e,t){return e===t}),u("array","{$alias} must be an array.",function(e){return!D(e)}),u("object","{$alias} must be an object.",function(e){return!M(e)}),u("string","{$alias} must be a string.",function(e){return!A(e)}),u("number","{$alias} must be a number.",function(e){return!z(e)}),u("boolean","{$alias} must be a true or false.",function(e){return!N(e)}),u("model","{$alias} must have a value.",function(e){return!(e instanceof x)}),u("whole","{$alias} must be a whole number.",function(e,t,r){var n=a(e),i=parseFloat(e),s=!z(n);return s||(s=Math.floor(n)!==i,s||r(n)),s}),u("numeric","{$alias} must be numeric.",function(e,t,r){var a=n(e),i=!z(a);return i||r(a),i}),u("yesno","{$alias} must be a yes or no.",function(e,t,r){var n=B.Rules.yesno.map[e],a=!N(n);return a||r(n),a}),B.Rules.yesno.map={"true":!0,t:!0,yes:!0,y:!0,1:!0,"false":!1,f:!1,no:!1,n:!1,0:!1},B.Rules.abs=function(e,t,r,a,i){return function(e,t,r){return e=n(e),z(e)&&(e=Math.abs(e)),e}},B.Rules.apply=function(e,t,r,n,a){return function(t,r,n){return r.$set(e,t),t}},B.Rules.base64=function(t,r,n,a,i){return function(t,r,n){return e.btoa&&(t=e.btoa(t)),t}},B.Rules.ceil=function(e,t,r,a,i){return function(e,t,r){return e=n(e),z(e)&&(e=Math.ceil(e)),e}},B.Rules.endOfDay=function(e,t,r,n,a){return function(e,t,r){return s(e)}},B.Rules.filter=function(e,t,r,n,a){return function(e,t,r){if(D(e))for(var n=e.length-1;n>=0;n--)k(e[n])||e.splice(n,1);else if(M(e))for(var a in e)k(e[a])||delete e[a];return e}},B.Rules.floor=function(e,t,r,a,i){return function(e,t,r){return e=n(e),z(e)&&(e=Math.floor(e)),e}},B.Rules.mod=function(e,t,r,a,i){var s=n(t);if(!z(s))throw'"'+s+'" is not a valid number for the mod rule.';return function(e,t,r){return e=n(e),z(e)&&(e%=s),e}},B.Rules["null"]=function(e,t,r,n,a){return function(t,r,n){return r.$set(e,null),null}},B.Rules.round=function(e,t,r,a,i){return function(e,t,r){return e=n(e),z(e)&&(e=Math.round(e)),e}},B.Rules.startOfDay=function(e,t,r,n,a){return function(e,t,r){return i(e)}},B.Rules.trim=function(e,t,r,n,a){if(!String.prototype.trim){var i=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(i,"")}}return function(e,t,r){return A(e)&&(e=e.trim()),e}},B.Rules.unbase64=function(t,r,n,a,i){return function(t,r,n){return e.atob&&(t=e.atob(t)),t}},t.Validation=B,t.ruleGenerator=u,t.rangeRuleGenerator=R,t.collectionRuleGenerator=d,t.dateRuleGenerator=h,t.fieldListRuleGenerator=v,t.fieldsRuleGenerator=$,t.foreignRuleGenerator=g,t.subRuleGenerator=b,t.listRuleGenerator=p,t.regexRuleGenerator=w,t.sizeRuleGenerator=y,t.joinFriendly=l,t.tryParseFloat=n,t.tryParseInt=a,t.startOfDay=i,t.endOfDay=s,t.determineMessage=o,t.mapFromArray=f,t.checkNoParams=c,t.generateMessage=m}(this,Rekord);
//# sourceMappingURL=rekord-validation.min.js.map
